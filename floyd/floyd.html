<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Floyd</title>
    <style>
      .memscripten { padding-right: 0; margin-left: auto; margin-right: auto; display: block; }
    </style>
</head>
<body>
    <div class="emscripten">
        <progress value="0" max="100" id="progress" hidden=0></progress>
    </div>  
    <p id="output" ></p>
    <textarea class="text_edit" id="floyd_text">set i=10; print(i);print("Hello World");</textarea>
    <br/>
    <input type="button" value="Run" onclick="view_text()" />    
    <br/>  
    <div id="view_result"></div>
    <script>
      function view_text () {
            console.log("click\n");
            // Find html elements.
            var textArea = document.getElementById('floyd_text');
            var text = textArea.value;

            FS.createDataFile("/", "example.floyd", text, true, true);

            var div = document.getElementById('view_result');


            // Could be runtests
            Module['arguments'].push('run');
            Module['arguments'].push('example.floyd');

            div.innerHTML =  text;

            //Module.initRuntime();
            Module.run();
            
            //console.log(Object.keys(Module));

            // TODO clear....
            //Module['arguments'].clear();
            //FS.unlink("/example.floyd");

            console.log("done\n");
      }

			var Module = {
				print: (function() {
					var element = document.getElementById('output');
					return function(text) {
						element.innerHTML += text + "<br>";
					};
				})(),
				printErr: function(text) {
						if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
						if (0) {
							dump(text + '\n');
						}
				},				
				canvas: (function() {
					var canvas = document.getElementById('canvas');
					return canvas;
        })(),
        'noInitialRun' : true,
        'ENVIRONMENT'  : 'WEB'
      };
		</script>
    <script src = "floyd.js"></script>
</body>
</html>
